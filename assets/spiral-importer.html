<!--
@license
MIT License. Copyright (c) 2015 Hongchan Choi. All rights reserved.
-->
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">

<!--
Import external JS code. Works as a container, code injector.

Example:

    <spiral-importer></spiral-importer>
-->
<dom-module id="spiral-importer">

  <style is="custom-style">
    :host {
      @apply(--layout);
      width: 100%;
      min-width: 320px;
      overflow: hidden;
    }

    .title {
      font-size: 1.1em;
      color: #999;
    }

    .url-input {
      width: 480px;
      margin-bottom: 0.45em;
      color: var(--google-blue-700);
      --paper-input-container-input: {
        font-size: 0.9em;
      };
      --paper-input-suffix: {
        line-height: 20px;
      };
    }

    .section-url-list paper-item {
      font-size: 0.9em;
      padding: 0;
      min-height: 2.5em;
    }


  </style>

  <template>
    <div class="vertical layout">

      <div class="title">Import External Library</div>

      <paper-input id="eUrlInput" class="url-input" label="Add a new URL" always-float-label>
        <paper-icon-button suffix on-click="_onBtnAddUrl" icon="add">
        </paper-icon-button>
      </paper-input>

      <div class="code-url">
        <paper-menu class="list section-url-list">
          <template id="eUrlList" is="dom-repeat" items="{{_resources}}">
            <paper-item>
              <span class="flex">{{item.url}}</span>
              <paper-icon-button icon="clear" on-click="_onBtnDeleteUrl">
              </paper-icon-button>
            </paper-item>
          </template>
        </paper-menu>
      </div>

    </div>

    <iron-ajax id="eXhrLoader"
      handle-as="text"
      on-response="_handleXhrResponse"
      on-error="_handleXhrError"></iron-ajax>

    <paper-toast id="toast"></paper-toast>

  </template>

</dom-module>

<script>

  Polymer({

    is: 'spiral-importer',

    properties: {

      _resources: {
        type: Array,
        value: [{
          url: 'https://raw.githubusercontent.com/hoch/spiral/master/spiral.min.js',
          source: null
        }, {
          url: 'https://github.com/PolymerLabs/polymer-file/blob/master/polymer-file.html',
          source: null
        }]
      }

    },

    _initialize: function () {
      // this._loadScriptFromUrls();
    },

    // Handle 'add button'.
    _onBtnAddUrl: function (event) {
      if(this.$.eUrlInput.value.length === 0)
        return;

      this.push('_resources', {
        url: this.$.eUrlInput.value,
        source: null
      });

      this.$.eUrlInput.value = '';
    },

    // Handle 'delete button'.
    _onBtnDeleteUrl: function (event) {
      var index = this._resources.indexOf(event.model);
      this.splice('_resources', index, 1);
    },

    _handleXhrResponse: function (event) {
      console.dir(event.detail.response);
    },

    _handleXhrError: function (event) {
      console.log(event.detail.error.message);
    },

    // Fetch the script and store inside of this element.
    _loadScriptFromUrls: function () {
      this.$.eXhrLoader.url = model.url;
      this.$.eXhrLoader.generateRequest();
    },

    created: function () {},

    ready: function() {},

    attached: function() {
      this._initialize();
    }

  });

</script>
